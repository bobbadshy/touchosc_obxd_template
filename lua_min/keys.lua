local a=2;local b=3;local c=self.frame.w/2;local d=self.frame.h;local e=c;local f=false;local g=2;local h=8192*0.75;local i=true;local j=true;local k=true;local l=0;local m=0;local n=0;local o=8192;function onReceiveNotify(p,q)if p=='pbEnabled'then if q==1 then f=true else f=false end elseif p=='atEnabled'then if q==1 then i=true else i=false end elseif p=='pbSensitivity'then g=q elseif p=='pbMaxValue'then h=q end end;function onValueChanged(r)if r=='touch'then if self.values.touch then l=0;m=0;n=0;o=8192;self.parent.parent:notify('press')else self.parent.parent:notify('release')end end end;function onPointer(s)local t=s[1]local u=t.state;if u==PointerState.BEGIN then e=t.x;start_y=t.y elseif u==PointerState.END then if f then self.messages.MIDI[2]:trigger()end elseif u==PointerState.MOVE then if f then applyPitchBend(t.x)end;if i then applyAftertouch(t.y)end;if j then applyChannelAftertouch(t.y)end;if k then applyModulation(t.y)end end end;function applyPitchBend(v)local w=(v-e)/c;local x=math.min(1,math.abs(w)^g)*h;if x==o then return end;if w<=0 then x=h-x else x=h+x end;o=x;local y=self.messages.MIDI[a]:data()y[2]=math.floor(math.fmod(x,128))y[3]=math.floor(x/128)sendMIDI(y)end;function applyAftertouch(z)local w=z/d;local x=math.min(1,math.max(0,w))if x==l then return end;l=x;local y=self.messages.MIDI[b]:data()y[3]=math.floor(x*127)sendMIDI(y)end;function applyChannelAftertouch(z)local w=z/d;local x=math.min(1,math.max(0,w))x=math.floor(x*127)if x==m then return end;m=x;self.parent.parent:notify('pressure',m)end;function applyModulation(z)local w=math.abs(2*(z-start_y)/d)local x=math.min(1,math.max(0,w))x=math.floor(x*127)if x==n then return end;n=x;self.parent.parent:notify('modulation',n)end

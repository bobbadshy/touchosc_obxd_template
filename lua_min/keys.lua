local a=2;local b=3;local c=self.frame.w/2;local d=self.frame.h;local e=c;local f=false;local g=2;local h=8192*0.75;local i=true;local j=0;local k=8192;function onReceiveNotify(l,m)if l=='pbEnabled'then if m==1 then f=true else f=false end elseif l=='atEnabled'then if m==1 then i=true else i=false end elseif l=='pbSensitivity'then g=m elseif l=='pbMaxValue'then h=m end end;function onPointer(n)local o=n[1]local p=o.state;if p==PointerState.BEGIN then e=o.x;start_y=o.y elseif p==PointerState.END then if f then self.messages.MIDI[2]:trigger()end elseif p==PointerState.MOVE then if f then applyPitchBend(o.x)end;if i then applyAftertouch(o.y)end end end;function applyPitchBend(q)local r=(q-e)/c;local s=math.min(1,math.abs(r)^g)*h;if s==k then return end;if r<=0 then s=h-s else s=h+s end;k=s;local t=self.messages.MIDI[a]:data()t[2]=math.floor(math.fmod(s,128))t[3]=math.floor(s/128)sendMIDI(t)end;function applyAftertouch(u)local r=u/d;local s=math.min(1,math.max(0,r))if s==j then return end;j=s;local t=self.messages.MIDI[b]:data()t[3]=math.floor(s*127)sendMIDI(t)end

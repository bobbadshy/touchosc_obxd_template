local a=2;local b=3;local c=self.frame.w;local d=self.frame.h;local e=c/2;local f=true;local g=true;local h=false;local i=false;local j=false;local k=false;local l=false;local m=false;local n=false;local o=false;local p=2;local q=8192*0.75;local r=0;local s=0;local t=0;local u=8192;local v=0.0;local w=0.0;function onReceiveNotify(x,y)if x=='pbEnabledHorz'then h=y elseif x=='pbEnabledVert'then i=y elseif x=='atEnabledHorz'then l=y elseif x=='atEnabledVert'then m=y elseif x=='cAtEnabledHorz'then j=y elseif x=='cAtEnabledVert'then k=y elseif x=='modEnabledHorz'then f=y elseif x=='modEnabledVert'then g=y elseif x=='midiCCHorzEnabled'then print(y)n=y elseif x=='midiCCVertEnabled'then print(y)o=y elseif x=='pbSensitivity'then p=y elseif x=='pbMaxValue'then q=y end end;function onValueChanged(z)if z=='touch'then if self.values.touch then r=0;s=0;t=0;u=8192;self.parent.parent:notify('press')else self.parent.parent:notify('release')end end end;function onPointer(A)local B=A[1]local C=B.state;if C==PointerState.BEGIN then e=B.x;start_y=B.y elseif C==PointerState.END then if h then self.messages.MIDI[2]:trigger()end elseif C==PointerState.MOVE then if h then applyPitchBend(B.x-e,c)end;if i then applyPitchBend(start_y-B.y,d)end;if f then applyModulation(B.x,e,c)end;if g then applyModulation(B.y,start_y,d)end;if j then applyChannelAftertouch(B.x,e)end;if k then applyChannelAftertouch(B.y,start_y)end;if l then applyAftertouch(B.x,e)end;if m then applyAftertouch(B.y,start_y)end;if n then applyMidiCCHorz(B.x)end;if o then applyMidiCCVert(B.y)end end end;function applyPitchBend(D,E)local F=D/(E/2)local G=math.min(1,math.abs(F)^p)*q;if math.abs(u-G)<u*0.01 then return end;if F<=0 then G=8192-G else G=8192+G end;G=math.max(0,math.min(16383,G))u=0.5*(u+G)local H=self.messages.MIDI[a]:data()H[2]=math.floor(math.fmod(G,128))H[3]=math.floor(G/128)sendMIDI(H)end;function applyAftertouch(I,E)local F=I/E;local G=math.min(1,math.max(0,F))if G==r then return end;r=G;local H=self.messages.MIDI[b]:data()H[3]=math.floor(G*127)sendMIDI(H)end;function applyChannelAftertouch(I,E)local F=I/E;local G=math.min(1,math.max(0,F))G=math.floor(G*127)if G==s then return end;s=G;self.parent.parent:notify('pressure',s)end;function applyModulation(I,J,E)local F=math.abs(2*((I-J)/E)^2)local G=math.min(1,math.max(0,F))G=math.floor(G*127)if G==t then return end;t=G;self.parent.parent:notify('modulation',t)end;function applyMidiCCHorz(I)local G=(I-e)/c;if G<0 then G=-1*G^2 else G=G^2 end;if G==v then return end;v=G;self.parent.parent:notify('midiCCHorz',v)end;function applyMidiCCVert(I)local G=(start_y-I)/d;if G<0 then G=-1*G^2 else G=G^2 end;if G==w then return end;w=G;self.parent.parent:notify('midiCCVert',w)end
